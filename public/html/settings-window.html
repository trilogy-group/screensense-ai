<!doctype html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2196f3;
        --primary-hover: #1976d2;
        --background: #1a1a1a;
        --surface: #2d2d2d;
        --text: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.7);
        --border: rgba(255, 255, 255, 0.1);
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          Roboto,
          Helvetica,
          Arial,
          sans-serif;
      }

      body {
        background: var(--background);
        color: var(--text);
        min-height: 100vh;
        line-height: 1.5;
        font-size: 14px;
      }

      .container {
        height: 100vh;
        display: grid;
        grid-template-rows: auto 1fr auto;
      }

      .header {
        padding: var(--spacing-lg) var(--spacing-xl);
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        text-align: center;
        height: 50px;
      }

      .header h1 {
        font-size: 20px;
        color: var(--text);
        margin: -10px;
      }

      .content {
        padding: var(--spacing-xl);
        overflow-y: auto;
      }

      .settings-section {
        max-width: 100%;
        margin: 0 auto;
      }

      .settings-group {
        background: var(--surface);
        border-radius: 12px;
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
      }

      .form-group {
        margin-bottom: var(--spacing-lg);
      }

      .form-group:last-child {
        margin-bottom: 0;
      }

      .form-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        color: var(--text);
        font-weight: 500;
      }

      .input-group {
        display: flex;
        gap: var(--spacing-md);
        align-items: center;
      }

      .form-input {
        flex: 1;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background: rgba(255, 255, 255, 0.1);
      }

      .form-input::placeholder {
        color: var(--text-secondary);
      }

      .help-link {
        display: inline-flex;
        align-items: center;
        padding: 8px 12px;
        color: var(--primary-color);
        text-decoration: none;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .help-link:hover {
        background: rgba(33, 150, 243, 0.1);
      }

      .help-link svg {
        margin-left: var(--spacing-xs);
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text);
      }

      .btn-secondary:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.15);
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: var(--primary-hover);
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover:not(:disabled) {
        background: #c82333;
      }

      .version-info {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
      }

      .version-text {
        color: var(--text-secondary);
        font-size: 14px;
      }

      .check-update-btn {
        background: var(--primary-color);
        border: none;
        color: white;
        font-size: 14px;
        cursor: pointer;
        padding: 8px 16px;
        border-radius: 6px;
        transition: all 0.2s ease;
        font-weight: 500;
      }

      .check-update-btn:hover {
        background: var(--primary-hover);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .settings-section {
        animation: fadeIn 0.3s ease;
      }

      .api-description {
        margin-top: var(--spacing-xs);
        font-size: 12px;
        color: var(--text-secondary);
      }

      .api-description.required {
        color: #2196f3;
      }

      .api-description.recommended {
        color: #ff9800;
      }

      .api-description.optional {
        color: var(--text-secondary);
      }

      .actions {
        display: flex;
        justify-content: space-between;
        height: 50px;
        align-items: center;
        padding: var(--spacing-lg) var(--spacing-xl);
        background: var(--surface);
        border-top: 1px solid var(--border);
      }

      .actions-left {
        display: flex;
        gap: var(--spacing-md);
      }

      .actions-right {
        display: flex;
        gap: var(--spacing-md);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>Settings</h1>
      </header>

      <main class="content">
        <div class="settings-section">
          <form id="settings-form">
            <div class="settings-group">
              <div class="form-group">
                <label class="form-label" for="gemini-api-key-input">Gemini API Key</label>
                <div class="input-group">
                  <input
                    type="password"
                    id="gemini-api-key-input"
                    placeholder="Enter your API key"
                    class="form-input"
                    required
                  />
                  <a href="https://aistudio.google.com/apikey" target="_blank" class="help-link">
                    Get API key
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M12 8.66667V12.6667C12 13.0203 11.8595 13.3594 11.6095 13.6095C11.3594 13.8595 11.0203 14 10.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V5.33333C2 4.97971 2.14048 4.64057 2.39052 4.39052C2.64057 4.14048 2.97971 4 3.33333 4H7.33333"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M10 2H14V6"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M6.66666 9.33333L14 2"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </div>
                <p class="api-description required">
                  Required - Powers the core functionality of the app
                </p>
              </div>
              <div class="form-group">
                <label class="form-label" for="openai-api-key-input">OpenAI API Key</label>
                <div class="input-group">
                  <input
                    type="password"
                    id="openai-api-key-input"
                    placeholder="Enter your API key"
                    class="form-input"
                  />
                  <a href="https://platform.openai.com/api-keys" target="_blank" class="help-link">
                    Get API key
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M12 8.66667V12.6667C12 13.0203 11.8595 13.3594 11.6095 13.6095C11.3594 13.8595 11.0203 14 10.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V5.33333C2 4.97971 2.14048 4.64057 2.39052 4.39052C2.64057 4.14048 2.97971 4 3.33333 4H7.33333"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M10 2H14V6"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M6.66666 9.33333L14 2"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </div>
                <p class="api-description recommended">
                  Strongly Recommended - Enables context persistence between sessions
                </p>
              </div>
              <div class="form-group">
                <label class="form-label" for="anthropic-api-key-input">Anthropic API Key</label>
                <div class="input-group">
                  <input
                    type="password"
                    id="anthropic-api-key-input"
                    placeholder="Enter your API key"
                    class="form-input"
                  />
                  <a
                    href="https://console.anthropic.com/account/keys"
                    target="_blank"
                    class="help-link"
                  >
                    Get API key
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M12 8.66667V12.6667C12 13.0203 11.8595 13.3594 11.6095 13.6095C11.3594 13.8595 11.0203 14 10.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V5.33333C2 4.97971 2.14048 4.64057 2.39052 4.39052C2.64057 4.14048 2.97971 4 3.33333 4H7.33333"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M10 2H14V6"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        d="M6.66666 9.33333L14 2"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                </div>
                <p class="api-description optional">
                  Optional - Powers the patent generator and knowledge curator assistants
                </p>
              </div>
            </div>

            <div class="settings-group">
              <div class="form-group">
                <label class="form-label">Application Version</label>
                <div class="version-info">
                  <span id="version-text" class="version-text">Version -</span>
                  <div style="flex: 1"></div>
                  <button type="button" class="check-update-btn" onclick="checkForUpdates()">
                    Check for Updates
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </main>

      <footer class="actions">
        <div class="actions-left">
          <button type="button" id="sign-out-button" class="btn btn-danger">Sign Out</button>
        </div>
        <div class="actions-right">
          <button type="button" id="cancel-button" class="btn btn-secondary">Cancel</button>
          <button type="submit" id="save-button" form="settings-form" class="btn btn-primary">
            Save Changes
          </button>
        </div>
      </footer>
    </div>

    <script>
      const { ipcRenderer } = require('electron');

      const form = document.getElementById('settings-form');
      const geminiApiKeyInput = document.getElementById('gemini-api-key-input');
      const openaiApiKeyInput = document.getElementById('openai-api-key-input');
      const anthropicApiKeyInput = document.getElementById('anthropic-api-key-input');
      const saveButton = document.getElementById('save-button');
      const cancelButton = document.getElementById('cancel-button');
      const versionText = document.getElementById('version-text');
      const signOutButton = document.getElementById('sign-out-button');

      // Initialize with current API keys and version
      ipcRenderer.on(
        'init-settings',
        (event, { geminiApiKey, openaiApiKey, anthropicApiKey, appVersion }) => {
          geminiApiKeyInput.value = geminiApiKey || '';
          openaiApiKeyInput.value = openaiApiKey || '';
          anthropicApiKeyInput.value = anthropicApiKey || '';
          saveButton.disabled = !geminiApiKey;
          versionText.textContent = `Version ${appVersion}`;
        }
      );

      // Enable/disable save button based on input
      const checkInputs = () => {
        const hasGeminiKey = geminiApiKeyInput.value.trim();
        saveButton.disabled = !hasGeminiKey;
      };

      geminiApiKeyInput.addEventListener('input', checkInputs);
      openaiApiKeyInput.addEventListener('input', checkInputs);
      anthropicApiKeyInput.addEventListener('input', checkInputs);

      // Handle form submission
      form.addEventListener('submit', e => {
        e.preventDefault();
        const geminiApiKey = geminiApiKeyInput.value.trim();
        const openaiApiKey = openaiApiKeyInput.value.trim();
        const anthropicApiKey = anthropicApiKeyInput.value.trim();
        if (geminiApiKey) {
          ipcRenderer.send('save-settings', { geminiApiKey, openaiApiKey, anthropicApiKey });
        }
      });

      // Handle cancel button
      cancelButton.addEventListener('click', () => {
        ipcRenderer.send('close-settings');
      });

      // Handle check for updates
      function checkForUpdates() {
        ipcRenderer.send('check-for-update');
      }

      // Handle sign out
      signOutButton.addEventListener('click', async () => {
        const confirmed = confirm('Are you sure you want to sign out?');
        if (confirmed) {
          const success = await ipcRenderer.invoke('sign-out');
          if (!success) {
            alert('Failed to sign out. Please try again.');
          }
        }
      });
    </script>
  </body>
</html>
